<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#020305">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192x192/f59e0b/000000?text=DB">
    <title>JDP SUPREME - DONY BURGUERS</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --jdp-gold: #f59e0b;
            --jdp-gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --jdp-bg: #020305;
            --jdp-glass: rgba(20, 22, 28, 0.95);
            --carbon: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        body { 
            background: var(--jdp-bg); 
            color: #fff; 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 90px 15px 120px 15px; 
            overflow-x: hidden; 
        }

        .nome-ouro-header {
            background: var(--jdp-gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            font-size: 14px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .btn-reset-cliente {
            position: fixed;
            top: 80px;
            right: 15px;
            background: none;
            border: none;
            color: rgba(255, 0, 0, 0.25);
            font-size: 35px;
            font-weight: bold;
            z-index: 1500;
        }

        #surprise-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .resplendor-ouro {
            font-size: 45px;
            font-weight: 900;
            text-align: center;
            background: linear-gradient(to right, #bf953f 20%, #fcf6ba 40%, #ffffff 50%, #fcf6ba 60%, #bf953f 80%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine-gold 1.5s linear infinite;
        }

        @keyframes shine-gold { to { background-position: 200% center; } }

        .header-supreme {
            position: fixed; top: 0; left: 0; right: 0; height: 75px;
            background: var(--jdp-glass); backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--jdp-gold); z-index: 1000;
            display: flex; justify-content: space-between; align-items: center; padding: 0 20px;
        }

        .grid-vendas { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .card-venda {
            background: var(--jdp-glass); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; overflow: hidden; position: relative;
        }
        .card-venda img { width: 100%; height: 120px; object-fit: cover; }
        .badge-qtd { position: absolute; top: 5px; right: 5px; background: var(--jdp-gold); color: #000; padding: 2px 8px; border-radius: 5px; font-weight: 900; }

        .btn-finalizar { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; background: var(--jdp-gold-gradient); color: #000; padding: 20px; border-radius: 12px; font-weight: 900; border: none; z-index: 1100; }
        
        #modal-supreme { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 2000; padding: 20px; flex-direction: column; align-items: center; justify-content: center; }
        .comprovante-ouro { width: 100%; max-width: 340px; background: #0a0a0a var(--carbon); border: 2px solid var(--jdp-gold); padding: 25px; }
    </style>
</head>
<body>

    <button class="btn-reset-cliente" onclick="limparErroCliente()">&times;</button>

    <div id="surprise-overlay">
        <div id="surprise-text" class="resplendor-ouro">DONY-BURGUERS</div>
    </div>

    <div class="header-supreme">
        <div style="width:100px;"> <span class="nome-ouro-header">DONY BURGUERS</span> </div> 
        <div>
            <div style="font-size:9px; color:var(--jdp-gold);">ITENS</div>
            <div id="mini-qtd" style="font-size:22px; font-weight:900;">00</div>
        </div>
        <div style="text-align: right; width:100px;">
            <div style="font-size:9px; color:var(--jdp-gold);">TOTAL</div>
            <div id="mini-total" style="font-size:22px; font-weight:900; color:var(--jdp-gold);">R$ 0,00</div>
        </div>
    </div>

    <div class="grid-vendas" id="vitrine"></div>

    <button class="btn-finalizar" onclick="gerarConfirmacao()">CONFIRMAR PEDIDO</button>

    <div id="modal-supreme">
        <div class="comprovante-ouro" id="print-area">
            <h2 style="text-align:center; color:var(--jdp-gold);">DONY BURGUERS</h2>
            <div id="comp-itens-list"></div>
            <div style="margin-top:15px; border:1px solid var(--jdp-gold); display:flex; justify-content:space-between; padding:10px;">
                <span>TOTAL</span> <span id="comp-total"></span>
            </div>
            <div id="txt-evangelico" style="margin-top:10px; font-size:10px; color:#bf953f; text-align:center;"></div>
        </div>
        <button style="width:100%; background:#25D366; color:#fff; padding:15px; margin-top:10px; border:none; font-weight:900;" onclick="ativarProtocoloOuro()">ENVIAR WHATSAPP</button>
        <button onclick="fecharModal()" style="color:#555; background:none; border:none; margin-top:10px;">CANCELAR</button>
    </div>

    <script>
        // Configuração do Firebase (Mantenha a sua original aqui)
        const firebaseConfig = {
            apiKey: "AIzaSyCEdXF7ScnMYz0Ce0OW-B_UJ8Bm5Pl9m8o",
            authDomain: "dony-burguers.firebaseapp.com",
            databaseURL: "https://dony-burguers-default-rtdb.firebaseio.com",
            projectId: "dony-burguers",
            storageBucket: "dony-burguers.firebasestorage.app",
            messagingSenderId: "511509845142",
            appId: "1:511509845142:web:9b0254a09ad8051e039eb7"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let carrinho = [];
        let produtosGlobais = [];

        window.onload = () => {
            db.ref('cardapio_supreme').on('value', snap => {
                const data = snap.val();
                produtosGlobais = data ? Object.entries(data).map(([id, val]) => ({id, ...val})) : [];
                renderizar();
            });
            
            // REGISTRO DO SERVICE WORKER
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                .then(() => console.log("Service Worker Ativo"))
                .catch(err => console.log("Erro SW:", err));
            }
        };

        function renderizar() {
            const vitrine = document.getElementById('vitrine');
            let total = 0, itens = 0;
            carrinho.forEach(c => { total += (c.preco * c.qtd); itens += c.qtd; });
            document.getElementById('mini-total').innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('mini-qtd').innerText = itens.toString().padStart(2, '0');

            vitrine.innerHTML = produtosGlobais.map((p, i) => {
                const item = carrinho.find(c => c.nome === p.nome);
                const qtd = item ? item.qtd : 0;
                return `
                    <div class="card-venda" onclick="addCarrinho(${i})">
                        ${qtd > 0 ? `<div class="badge-qtd">${qtd}</div>` : ''}
                        <img src="${p.link}">
                        <div style="padding:10px; text-align:center;">
                            <div style="font-size:11px;">${p.nome}</div>
                            <div style="font-weight:900">R$ ${parseFloat(p.preco).toFixed(2)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addCarrinho(i) {
            const p = produtosGlobais[i];
            const item = carrinho.find(c => c.nome === p.nome);
            if (item) item.qtd++; else carrinho.push({ ...p, qtd: 1 });
            renderizar();
        }

        function gerarConfirmacao() {
            if (carrinho.length === 0) return;
            document.getElementById('txt-evangelico').innerText = "O SENHOR É MEU PASTOR.";
            const list = document.getElementById('comp-itens-list');
            let total = 0;
            list.innerHTML = carrinho.map(i => {
                total += (i.qtd * i.preco);
                return `<div style="display:flex; justify-content:space-between; font-size:13px;"><span>${i.qtd}x ${i.nome}</span><span>R$ ${(i.qtd*i.preco).toFixed(2)}</span></div>`;
            }).join('');
            document.getElementById('comp-total').innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('modal-supreme').style.display = 'flex';
        }

        async function ativarProtocoloOuro() {
            const overlay = document.getElementById('surprise-overlay');
            overlay.style.display = 'flex';
            setTimeout(() => { 
                overlay.style.display = 'none'; 
                let msg = `*PEDIDO DONY BURGUERS*\n`;
                carrinho.forEach(i => { msg += `✅ ${i.qtd}x ${i.nome}\n`; });
                window.location.href = `https://wa.me/5592984846058?text=${encodeURIComponent(msg)}`;
            }, 2000);
        }

        function fecharModal() { document.getElementById('modal-supreme').style.display = 'none'; }
        function limparErroCliente() { carrinho = []; renderizar(); }
    </script>
</body>
</html>
